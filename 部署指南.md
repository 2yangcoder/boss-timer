# BOSS计时器多人部署指南

## 🚀 项目概述

BOSS计时器已升级为支持多人使用的版本，具备以下特性：
- **多人数据共享**：所有用户看到相同的BOSS配置和击杀记录
- **实时数据同步**：一个用户的操作会立即同步到其他用户
- **降级兼容**：服务器不可用时自动降级到本地存储
- **数据持久化**：服务器端数据永久保存

## 📋 部署步骤

### 第一步：创建 Supabase 项目

1. 访问 [Supabase官网](https://supabase.com)
2. 注册账号并创建新项目
3. 获取项目URL和anon key：
   - 进入项目设置 → API
   - 复制 `URL` 和 `anon public` key

### 第二步：配置数据库表

在 Supabase SQL 编辑器中执行以下SQL：

```sql
-- 创建BOSS配置表
CREATE TABLE boss_configs (
  id SERIAL PRIMARY KEY,
  name VARCHAR(100) NOT NULL,
  category VARCHAR(50) NOT NULL,
  interval INTEGER NOT NULL,
  delay INTEGER DEFAULT 0,
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW()
);

-- 创建击杀记录表
CREATE TABLE kill_records (
  id SERIAL PRIMARY KEY,
  boss_id INTEGER REFERENCES boss_configs(id),
  kill_time TIMESTAMP NOT NULL,
  accuracy VARCHAR(20) DEFAULT 'accurate',
  recorded_by VARCHAR(100),
  created_at TIMESTAMP DEFAULT NOW()
);

-- 启用实时订阅
ALTER TABLE boss_configs REPLICA IDENTITY FULL;
ALTER TABLE kill_records REPLICA IDENTITY FULL;

-- 插入默认BOSS数据
INSERT INTO boss_configs (name, category, interval, delay) VALUES
('四一', '海底', 6, 0),
('五一', '海底', 6, 0),
('龙王', '海底', 6, 0),
('海魔', '海底', 8, 2),
('船长', '海底', 8, 0),
('神驹', '业火', 6, 0),
('魔君', '业火', 6, 0),
('囚笼', '业火', 8, 0),
('祖玛', '其他', 3, 2),
('老牛', '其他', 4, 0),
('魔王', '其他', 6, 120),
('毒龙', '其他', 24, 0);
```

### 第三步：配置应用

编辑 `config.js` 文件，替换为您的 Supabase 配置：

```javascript
// Supabase 配置
const SUPABASE_CONFIG = {
  url: 'https://your-project.supabase.co', // 替换为您的项目URL
  anonKey: 'your-anon-key' // 替换为您的anon key
};

// 数据存储配置
const CONFIG = {
  useServerStorage: true,
  syncInterval: 5000,
  enableRealtime: true
};
```

### 第四步：部署前端文件

将以下文件部署到Web服务器：
- `1.html` - 主页面
- `config.js` - 配置文件
- `server-data.js` - 服务器数据管理

支持任何静态文件托管服务：
- GitHub Pages
- Netlify
- Vercel
- 腾讯云静态网站托管
- 阿里云OSS

## 🔧 功能测试

部署完成后，请测试以下功能：

1. **基本功能测试**
   - 打开页面，查看BOSS列表是否正确显示
   - 点击"快速记录"，确认击杀时间被记录
   - 刷新页面，确认数据保留

2. **多人同步测试**
   - 在两个浏览器窗口同时打开应用
   - 在一个窗口记录击杀
   - 观察另一个窗口是否自动更新

3. **降级测试**
   - 修改 `config.js` 中的配置为错误信息
   - 刷新页面，确认应用降级到本地存储模式

## ⚙️ 高级配置

### 自定义BOSS配置

可以通过修改数据库中的 `boss_configs` 表来自定义BOSS：

```sql
-- 添加新BOSS
INSERT INTO boss_configs (name, category, interval, delay) 
VALUES ('新BOSS', '新分类', 4, 0);

-- 修改现有BOSS
UPDATE boss_configs SET interval = 8 WHERE name = '毒龙';
```

### 数据备份和恢复

应用支持数据导出导入功能：
- **导出**：点击"导出数据"按钮下载JSON备份
- **导入**：点击"导入数据"粘贴JSON数据
- **重置**：点击"重置数据"恢复到初始状态

### 性能优化

- **同步间隔**：在 `config.js` 中调整 `syncInterval`
- **实时订阅**：可禁用实时更新以减少服务器负载
- **缓存策略**：应用会自动缓存数据，减少服务器请求

## 🛠️ 故障排除

### 常见问题

1. **数据不同步**
   - 检查 Supabase 项目配置是否正确
   - 确认数据库表已正确创建
   - 查看浏览器控制台错误信息

2. **实时更新不工作**
   - 确认 `enableRealtime` 设置为 `true`
   - 检查网络连接是否稳定
   - 确认 Supabase 实时订阅功能正常

3. **页面加载失败**
   - 检查静态文件部署路径
   - 确认所有依赖文件都已上传
   - 查看浏览器网络面板的请求状态

### 日志查看

应用会在浏览器控制台输出详细日志：
- 连接状态
- 数据同步信息
- 错误详情

## 📞 技术支持

如遇到问题，请检查：
1. Supabase 项目状态和配额
2. 浏览器控制台错误信息
3. 网络连接状态
4. 文件部署路径和权限

部署完成后，所有用户访问同一URL即可看到实时同步的BOSS数据！